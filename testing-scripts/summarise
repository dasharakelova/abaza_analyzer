#!/bin/bash

# Copyright 2020-2021 Nick Howell
# SPDX-License-Identifier: AGPL-3

if [[ $# -eq 0 ]]; then
	echo "
summarise: summarise results of testing

usage: summarise <TEST-test.missing-stem>... <TEST-test.hfst.diag>...

  TEST-test.missing-stem  generated by running missing-stems on
                          TEST
  TEST-test.hfst.diag     generated by running match
" >&2;
	exit 1
elif [[ $# -gt 1 ]]; then
	for a in "$@"; do
		$0 "$a"
		echo
	done
	exit
fi

case "$1" in
*.missing-stem )

	echo "$1:"
	sed 's/^<.*>//' "$1" | sort | uniq -c
	;;
*.diag )
	echo "$1:"
	(
	sed 1d "$1" | cut -f2-3 -d: \
	| sort | uniq -c \
	| while read l; do
		echo
		echo "${l/ / matches::: }"
		l=( ${l//:/ } )
		awk -F: "\$2 == \"${l[1]}\" && \$3 == \"${l[2]}\" {print}" "$1" \
		| head -n3
	done) | cut --complement -f2-3 -d:
	;;
esac
